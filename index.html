<!DOCTYPE html>
<html>
<head>
  <title>Finalizar Compra</title>

  <!-- TikTok Pixel Base Code -->
  <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject = t;
      var ttq = w[t] = w[t] || [];
      ttq.methods = ["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"];
      ttq.setAndDefer = function(t, e) { t[e] = function() { t.push([e].concat(Array.prototype.slice.call(arguments,0))) } };
      for (var i = 0; i < ttq.methods.length; i++) ttq.setAndDefer(ttq, ttq.methods[i]);
      ttq.load = function(e, n) {
        var i = "https://analytics.tiktok.com/i18n/pixel/events.js";
        ttq._i = ttq._i || {};
        ttq._i[e] = [];
        ttq._i[e]._u = i;
        ttq._t = ttq._t || {};
        ttq._t[e] = +new Date;
        ttq.loadScript = function(t, e) {
          var n = d.createElement("script");
          n.type = "text/javascript";
          n.async = !0;
          n.src = t;
          var i = d.getElementsByTagName("script")[0];
          i.parentNode.insertBefore(n, i);
        };
        ttq.loadScript(i);
      };
      ttq.load('D47C8FBC77U2P8MCK090'); /* SEU PIXEL */
      ttq.page();
    }(window, document, 'ttq');
  </script>

  <style>
    button {
      padding: 16px 22px;
      background: #1a73e8;
      border: none;
      color: white;
      font-size: 20px;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>

</head>
<body>

  <h1>Finalizar Compra</h1>
  <p>Clique no botÃ£o abaixo para concluir sua compra:</p>

  <button id="btnPurchase">Concluir Compra</button>

  <script>
    document.getElementById("btnPurchase").addEventListener("click", function () {

      try {

        // Captura ttclid
        const urlParams = new URLSearchParams(window.location.search);
        let ttclid = urlParams.get("ttclid") || localStorage.getItem("ttclid");

        // Envia evento Purchase
        ttq.track("CompletePayment", {
          value: 09.90,                 // ðŸ”§ valor real
          currency: "BRL",
          contents: [{
            content_id: "produto_1",    // ðŸ”§ id do produto
            content_type: "product",
            quantity: 1
          }],
          user: {
            ttclid: ttclid || ""
          }
        });

        console.log("âœ” Purchase enviado com sucesso!");

      } catch (e) {
        console.error("Erro ao enviar purchase:", e);
      }

      // ðŸ”¥ OPCIONAL â€” redirecionar apÃ³s 600ms
      setTimeout(() => {
        window.location.href = "https://t.me/+KO_y0i7PbLE1YzNh";  // ðŸ”§ coloque seu link final
      }, 600);

    });
  </script>

</body>
</html>
